{"title":"促销天数","uid":"6fd2613b63b979add31ea79871f3311b","slug":"促销天数","date":"2023-10-09T07:15:51.000Z","updated":"2024-03-23T12:32:47.547Z","comments":true,"path":"api/articles/促销天数.json","keywords":null,"cover":null,"content":"<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">    id, </span><br><span class=\"line\">    <span class=\"built_in\">sum</span>(group_days) <span class=\"keyword\">AS</span> sum_group_days </span><br><span class=\"line\"><span class=\"keyword\">FROM</span> </span><br><span class=\"line\">(</span><br><span class=\"line\">    <span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">        id, group_id , DATEDIFF ( <span class=\"built_in\">MAX</span>(edt), <span class=\"built_in\">MIN</span>(stt) ) <span class=\"operator\">+</span> <span class=\"number\">1</span>  <span class=\"keyword\">AS</span> group_days</span><br><span class=\"line\">    <span class=\"keyword\">FROM</span> </span><br><span class=\"line\">    (</span><br><span class=\"line\">        <span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">            <span class=\"operator\">*</span>,</span><br><span class=\"line\">            <span class=\"built_in\">SUM</span>(</span><br><span class=\"line\">                <span class=\"keyword\">CASE</span> <span class=\"keyword\">WHEN</span> stt <span class=\"operator\">&gt;</span> max_lag_edt <span class=\"keyword\">THEN</span> <span class=\"number\">1</span> </span><br><span class=\"line\">                <span class=\"keyword\">ELSE</span> <span class=\"number\">0</span> </span><br><span class=\"line\">                <span class=\"keyword\">END</span> </span><br><span class=\"line\">            ) <span class=\"keyword\">OVER</span>( <span class=\"keyword\">PARTITION</span> <span class=\"keyword\">BY</span> id <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> stt ) <span class=\"keyword\">AS</span> group_id</span><br><span class=\"line\">        <span class=\"keyword\">FROM</span> </span><br><span class=\"line\">        (</span><br><span class=\"line\">            <span class=\"keyword\">SELECT</span></span><br><span class=\"line\">                <span class=\"operator\">*</span>,</span><br><span class=\"line\">                <span class=\"built_in\">MAX</span>(lag_edt) <span class=\"keyword\">OVER</span>( <span class=\"keyword\">PARTITION</span> <span class=\"keyword\">BY</span> id <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> stt ) <span class=\"keyword\">AS</span> max_lag_edt</span><br><span class=\"line\">            <span class=\"keyword\">FROM</span> </span><br><span class=\"line\">            (</span><br><span class=\"line\">                <span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">                    id, </span><br><span class=\"line\">                    stt, </span><br><span class=\"line\">                    edt, </span><br><span class=\"line\">                    <span class=\"built_in\">lag</span>(edt, <span class=\"number\">1</span>, <span class=\"string\">&#x27;1970-01-01&#x27;</span>) <span class=\"keyword\">OVER</span> (<span class=\"keyword\">PARTITION</span> <span class=\"keyword\">BY</span> id <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> stt) <span class=\"keyword\">AS</span> lag_edt</span><br><span class=\"line\">                <span class=\"keyword\">FROM</span> </span><br><span class=\"line\">                    test4 </span><br><span class=\"line\">            ) <span class=\"keyword\">AS</span> test4 </span><br><span class=\"line\">        ) <span class=\"keyword\">AS</span> test4</span><br><span class=\"line\">    )<span class=\"keyword\">AS</span> test4 </span><br><span class=\"line\">    <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> </span><br><span class=\"line\">        id, group_id </span><br><span class=\"line\">) <span class=\"keyword\">AS</span> test4</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> </span><br><span class=\"line\">    id</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">    id, </span><br><span class=\"line\">    <span class=\"built_in\">sum</span>(group_days) <span class=\"keyword\">AS</span> sum_group_days </span><br><span class=\"line\"><span class=\"keyword\">FROM</span> </span><br><span class=\"line\">(</span><br><span class=\"line\">    <span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">        id, group_id , DATEDIFF ( <span class=\"built_in\">MAX</span>(edt), <span class=\"built_in\">MIN</span>(stt) ) <span class=\"operator\">+</span> <span class=\"number\">1</span>  <span class=\"keyword\">AS</span> group_days</span><br><span class=\"line\">    <span class=\"keyword\">FROM</span> </span><br><span class=\"line\">    (</span><br><span class=\"line\">        <span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">            <span class=\"operator\">*</span>,</span><br><span class=\"line\">            <span class=\"built_in\">SUM</span>(</span><br><span class=\"line\">                <span class=\"keyword\">CASE</span> </span><br><span class=\"line\">                    <span class=\"keyword\">WHEN</span> stt <span class=\"operator\">&gt;</span> max_lag_edt <span class=\"keyword\">THEN</span> <span class=\"number\">1</span> </span><br><span class=\"line\">                    <span class=\"keyword\">WHEN</span> max_lag_edt <span class=\"keyword\">IS</span> <span class=\"keyword\">NULL</span> <span class=\"keyword\">THEN</span> <span class=\"number\">1</span> </span><br><span class=\"line\">                <span class=\"keyword\">ELSE</span> <span class=\"number\">0</span> </span><br><span class=\"line\">                <span class=\"keyword\">END</span> </span><br><span class=\"line\">            ) <span class=\"keyword\">OVER</span>( <span class=\"keyword\">PARTITION</span> <span class=\"keyword\">BY</span> id <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> stt ) <span class=\"keyword\">AS</span> group_id</span><br><span class=\"line\">        <span class=\"keyword\">FROM</span> </span><br><span class=\"line\">        (</span><br><span class=\"line\">            <span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">                id, </span><br><span class=\"line\">                stt, </span><br><span class=\"line\">                edt, </span><br><span class=\"line\">                <span class=\"built_in\">MAX</span>(edt) <span class=\"keyword\">OVER</span> (<span class=\"keyword\">PARTITION</span> <span class=\"keyword\">BY</span> id <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> stt <span class=\"keyword\">ROWS</span> <span class=\"keyword\">BETWEEN</span> UNBOUNDED PRECEDING <span class=\"keyword\">AND</span> <span class=\"number\">1</span> PRECEDING) <span class=\"keyword\">AS</span> max_lag_edt</span><br><span class=\"line\">            <span class=\"keyword\">FROM</span> </span><br><span class=\"line\">                test4 </span><br><span class=\"line\">        ) <span class=\"keyword\">AS</span> test4</span><br><span class=\"line\">    )<span class=\"keyword\">AS</span> test4 </span><br><span class=\"line\">    <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> </span><br><span class=\"line\">        id, group_id </span><br><span class=\"line\">) <span class=\"keyword\">AS</span> test4</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> </span><br><span class=\"line\">    id</span><br></pre></td></tr></table></figure>\n\n","feature":true,"text":"12345678910111213141516171819202122232425262728293031323334353637383940SELECT id, sum(group_days) AS sum_group_days FROM ( SELECT id, group_...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[],"tags":[],"toc":"","author":{"name":"艾木简 安斤涅尔","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/zhangshengshan/avatars@master/Snipaste_2023-06-01_15-43-21.png","link":"/","description":"海纳百川 有容乃大","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"隐私政策说明","uid":"74b1c66fe33c8651dd17f32e42245059","slug":"隐私政策说明","date":"2024-03-23T12:33:29.000Z","updated":"2024-03-23T12:38:54.518Z","comments":true,"path":"api/articles/隐私政策说明.json","keywords":null,"cover":null,"text":"《隐私政策》 本隐私政策适用于[应用名称]应用程序（以下简称“本应用”）。本应用尊重并保护用户的隐私，本隐私政策将详细说明本应用在收集、使用、存储和保护用户个人信息方面的政策和措施。 本应用不需要登录，不会收集用户的个人信息。 本应用不会将用户的个人信息共享给任何第三方，也不会将...","link":"","photos":[],"count_time":{"symbolsCount":622,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"艾木简 安斤涅尔","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/zhangshengshan/avatars@master/Snipaste_2023-06-01_15-43-21.png","link":"/","description":"海纳百川 有容乃大","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"连续问题","uid":"c034940dbc0051fc749d572e50027a6a","slug":"连续问题","date":"2023-10-09T03:24:47.000Z","updated":"2024-03-23T12:32:47.547Z","comments":true,"path":"api/articles/连续问题.json","keywords":null,"cover":null,"text":"123456CREATE TABLE test ( id STRING, dt STRING, lowcarbon BIGINT)ROW FORMAT DELIMITED FIELDS TERMINATED BY &#x27;,&#x27;; 123456789101112131...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[],"tags":[],"author":{"name":"艾木简 安斤涅尔","slug":"blog-author","avatar":"https://cdn.jsdelivr.net/gh/zhangshengshan/avatars@master/Snipaste_2023-06-01_15-43-21.png","link":"/","description":"海纳百川 有容乃大","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}